<!DOCTYPE html>

<head>
	<link rel="stylesheet" type="text/css" href="./style.css">
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js">
	</script>
	<meta charset="utf-8">

	<title>Event Finder</title>

</head>

<form id = "form" >

	Keywords:<br>
	<input type="text" name="search" id = "keywords"> </input><br>

	Date:<br>
	<input type="date" name="date" id = "date"></input>

	<input type="submit" value="Search" id="Search"></input>
</form>


<table id="results">
<tbody>
	<tr>
		<th>Event Name</th>
		<th>Date</th>
		<th>Venue</th>
	</tr>
</tbody>


</table>

<script type = "text/javascript">


$(document).ready(function(){
	$('#form').submit(function(event){
		event.preventDefault();

		//here it should erase previous table if it exists
		//should unhide
		var keywords = document.getElementById('keywords').value;
		var date = document.getElementById('date').value;

		$.ajax({
		//	console("sending ajax GET request");
			url: "./events/search?",
			type: "GET",
			data: {search: keywords, date: date}, //sends query in the format ./events/search?search=keywords&date=date
			contentType: "application/json; charset=utf-8",
			dataType: "json",
			statusCode: {
				200: function(){
					console.log("200: OK");
				}
			},
			success: function(data){
				console.log("Success");
				var stringOfJSON = JSON.stringify(data);
				var objectJSON = JSON.parse(stringOfJSON);
				console.log("JSON string: " + stringOfJSON);

				try{
					for(var i = 0; i < objectJSON.events.length; i++){
						var date = new Date(objectJSON.events[i].date);
						var newResult = "<tr><td>" + objectJSON.events[i].title +"</td><td>" + date.toDateString() +"</td><td>" + objectJSON.events[i].venue.name +"</td></tr>"; //new row in table for each result

						$('#results').append(newResult);
					}
				}

				catch(err){
					var errorString = objectJSON.error;
					document.getElementById("results").innerHTML = errorString;
				}

			},

			error: function(result){
				console.log(result);
			}
		});
	});
});
</script>





<body>
</body>
